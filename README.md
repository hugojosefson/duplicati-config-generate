# duplicati-generate-config

_Generate [duplicati](https://www.duplicati.com/) backup configs from a flat file._

Currently hard-coded for:

-   `TargetURL` expected to be for B2 Cloud Storage by Backblaze (`b2://...`).
-   Filter expressions based on using [linuxserver/duplicati](https://hub.docker.com/r/linuxserver/duplicati/) in Docker.

## Prerequisite

Node.js, at least `v8.3.0`.

Recommended to install latest via [nvm](https://github.com/creationix/nvm#readme):

```bash
nvm install stable
```

## Installation

```bash
npm install -g duplicati-generate-config
```

## Usage

```bash
duplicati-generate-config template-duplicati-config.json definitions.txt
```

Will read from `definitions.txt`, outputting config files to current directory, using `template-duplicati-config.json` as template.

### Template file format

Export an existing configuration from duplicati, and use that file.

### Definitions file format

Example `definitions.txt`:

    # 1st line of every block is name of backup set.
    # 2nd line is source directory.
    # Following lines are exclusions.
    # Empty line denotes end of block, and that backup set.

    virtual-machines/Keep to b2 backblaze
    /home/me/virtual-machines/Keep

    Videos/programming to b2 backblaze
    /home/me/Videos/Programming

    Important Downloads to b2 backblaze
    /home/me/Important Downloads

    code/old-stuff to b2 backblaze
    /home/me/code/old-stuff
    */node_modules/
    */target/

    code to b2 backblaze
    /home/me/code
    /home/me/code/old-stuff/
    */node_modules/
    */target/

    /home/me to b2 backblaze
    /home/me
    /home/me/code/
    /home/me/virtual-machines/
    /home/me/Important Downloads/
    /home/me/Downloads/
    /home/me/duplicati/backups/
    /home/me/lost+found/
    /home/me/Videos/
    /home/me/.Trash-1000/
    */node_modules/
    */target/

## Programmatic access

You can also `import` or `require` the module, and use its exported functions programmatically.

They make use of [Highland.js](http://highlandjs.org/) streams.

### API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### generateWriteSpecs

Converts duplicati template file contents, and backup definition flat file contents, into
definitions of what to write to disk.

**Parameters**

-   `templateFileContents` **Highland** Highland Stream of the contents of the duplicati
    template config file.
-   `definitionsFlatfileContents` **Highland** Highland Stream of the contents of the backup
    definitions flat file.

Returns **Highland&lt;{filename, contents}>** A Highland Stream definitions of what to write to disk

#### writeFile

Reads a file into a Highland Stream.

**Parameters**

-   `filename` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Filename to read from.

Returns **Highland&lt;[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)>** A Highland Stream of one String, the entire contents of the file.

#### writeFile

Writes a Highland Stream to a file.

**Parameters**

-   `filename` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Filename to write to.
-   `contents` **Highland&lt;[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)>** Highland Stream of one String, to write.

Returns **Highland&lt;[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)>** A Highland Stream of one String, the filename written.
